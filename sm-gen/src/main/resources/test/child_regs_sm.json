{
  "resourceType": "StructureMap",
  "id": "488593",
  "meta": {
    "versionId": "21",
    "lastUpdated": "2023-08-23T12:45:15.026+00:00",
    "source": "#f62f205ff6c0b82e"
  },
  "url": "https://fhir.demo.smartregister.org/fhir/StructureMap/488593",
  "name": "CHW child Patient Registration",
  "structure": [
    {
      "url": "http://hl7.org/fhir/StructureDefinition/QuestionnaireReponse",
      "mode": "source"
    },
    {
      "url": "http://hl7.org/fhir/StructureDefinition/Patient",
      "mode": "target"
    }
  ],
  "group": [
    {
      "name": "CHildRegistration",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireResponse",
          "mode": "source"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "rule_bundle_id",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "id",
              "transform": "uuid"
            }
          ]
        },
        {
          "name": "rule_bundle_type",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "type",
              "transform": "copy",
              "parameter": [
                {
                  "valueString": "collection"
                }
              ]
            }
          ]
        },
        {
          "name": "rule_bundle_entry",
          "source": [
            {
              "context": "src"
            }
          ],
          "dependent": [
            {
              "name": "ExtractChildResources",
              "variable": [
                "src",
                "bundle"
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractChildResources",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireResponse",
          "mode": "source"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "r_patient",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            },
            {
              "context": "entry",
              "contextType": "variable",
              "element": "resource",
              "variable": "patient",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Patient"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_patient_id_generation",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patient",
                  "contextType": "variable",
                  "element": "id",
                  "transform": "uuid"
                }
              ]
            },
            {
              "name": "rule_patient_name",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patient",
                  "contextType": "variable",
                  "element": "name",
                  "variable": "patientName",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "HumanName"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_family_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientName",
                      "contextType": "variable",
                      "element": "family",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = '76bad83a-f061-4b22-8b4f-a95cbd5be4da').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_given_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientName",
                      "contextType": "variable",
                      "element": "given",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = 'f7ee2d12-829e-4ca3-fe30-ddb5e809ac91').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_middle_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientName",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = '7b41d922-376c-49bf-f6a8-faaa681e9ef6').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_name_use",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientName",
                      "contextType": "variable",
                      "element": "use",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "official"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier_opensrp",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patient",
                  "contextType": "variable",
                  "element": "identifier",
                  "variable": "patientIdentifierOpenSRPId",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Identifier"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_identifier_opensrp_id_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifierOpenSRPId",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = 'ed77104e-c279-4030-ab20-8cd99ca99ca9').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_identifier_opensrp_id_use",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifierOpenSRPId",
                      "contextType": "variable",
                      "element": "use",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "official"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_identifier_period",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifierOpenSRPId",
                      "contextType": "variable",
                      "element": "period",
                      "variable": "period",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "Period"
                        }
                      ]
                    },
                    {
                      "context": "period",
                      "contextType": "variable",
                      "element": "start",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.authored"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patient",
                  "contextType": "variable",
                  "element": "identifier",
                  "variable": "patientIdentifier",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Identifier"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_identifier_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifier",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "uuid"
                    }
                  ]
                },
                {
                  "name": "rule_patient_identifier_use",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifier",
                      "contextType": "variable",
                      "element": "use",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "secondary"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_identifier_period",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifier",
                      "contextType": "variable",
                      "element": "period",
                      "variable": "period",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "Period"
                        }
                      ]
                    },
                    {
                      "context": "period",
                      "contextType": "variable",
                      "element": "start",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.authored"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_gender",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patient",
                  "contextType": "variable",
                  "element": "gender",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.item.where(linkId = '50330b11-c520-4f45-a8f4-44771097788d').answer.value.code"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_age",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "patient_age",
                  "condition": "((linkId = '8ebf5364-6bdc-4e45-89a7-28c65ce019b7') and (answer.count() > 0))"
                }
              ],
              "target": [
                {
                  "context": "patient",
                  "contextType": "variable",
                  "element": "birthDate",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "patient_age"
                    },
                    {
                      "valueString": "today() - (($this.answer.value * 30).toString() + ' days').toQuantity()"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_dob",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "patient_dob",
                  "condition": "(linkId = 'aa1ddb98-87a4-48a6-9d8c-4c80de1ec277')"
                }
              ],
              "rule": [
                {
                  "name": "rule__first_patient_dob",
                  "source": [
                    {
                      "context": "patient_dob",
                      "element": "answer",
                      "listMode": "first",
                      "variable": "patientBirthDateAnswer"
                    }
                  ],
                  "rule": [
                    {
                      "name": "rule_patient_dob_answer",
                      "source": [
                        {
                          "context": "patientBirthDateAnswer",
                          "element": "value",
                          "variable": "val"
                        }
                      ],
                      "target": [
                        {
                          "context": "patient",
                          "contextType": "variable",
                          "element": "birthDate",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueId": "val"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_active",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patient",
                  "contextType": "variable",
                  "element": "active",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueBoolean": true
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_address",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patient",
                  "contextType": "variable",
                  "element": "address",
                  "variable": "patientAddress",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Address"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_address_district",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientAddress",
                      "contextType": "variable",
                      "element": "district",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = '1b87fbf5-1330-4e65-8364-10cbf7c0a3e3').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_address_use",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientAddress",
                      "contextType": "variable",
                      "element": "use",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "home"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_address_type",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientAddress",
                      "contextType": "variable",
                      "element": "type",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "physical"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_mother",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "item",
                  "condition": "where($this.linkId.where(contains('3d453a4e-8548-468f-81b7-e5451abe1106')).exists() and ($this.answer.value.code = 'yes'))"
                }
              ],
              "rule": [
                {
                  "name": "r_patient_mother",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "dependent": [
                    {
                      "name": "ExtractPatientMother",
                      "variable": [
                        "src",
                        "bundle"
                      ]
                    }
                  ]
                },
                {
                  "name": "r_relatedPerson_mother",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "dependent": [
                    {
                      "name": "ExtractRelatedPersonMother",
                      "variable": [
                        "src",
                        "patient",
                        "bundle"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_father",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "item",
                  "condition": "where($this.linkId.where(contains('d02e3a9e-ede2-4cd5-9c98-cc5824c06ac4')).exists() and ($this.answer.value.code = 'yes'))"
                }
              ],
              "rule": [
                {
                  "name": "r_patient_father",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "dependent": [
                    {
                      "name": "ExtractPatientFather",
                      "variable": [
                        "src",
                        "bundle"
                      ]
                    }
                  ]
                },
                {
                  "name": "r_relatedPerson_father",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "dependent": [
                    {
                      "name": "ExtractRelatedPersonFather",
                      "variable": [
                        "src",
                        "patient",
                        "bundle"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_child_encounter",
              "source": [
                {
                  "context": "src"
                }
              ],
              "dependent": [
                {
                  "name": "ExtractEncounter",
                  "variable": [
                    "src",
                    "patient",
                    "bundle"
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractPatientMother",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireResponse",
          "mode": "source"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "rule_mother",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "where($this.linkId.where(contains('3d453a4e-8548-468f-81b7-e5451abe1106')).exists() and ($this.answer.value.code = 'yes'))"
            }
          ],
          "rule": [
            {
              "name": "rule_mother",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "bundle",
                  "contextType": "variable",
                  "element": "entry",
                  "variable": "entry"
                },
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "variable": "mother",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Patient"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_mother_id_generation",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "mother",
                      "contextType": "variable",
                      "element": "id",
                      "transform": "uuid"
                    }
                  ]
                },
                {
                  "name": "rule_mother_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "mother",
                      "contextType": "variable",
                      "element": "name",
                      "variable": "patientName",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "HumanName"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "rule_mother_family_name",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "patientName",
                          "contextType": "variable",
                          "element": "family",
                          "transform": "evaluate",
                          "parameter": [
                            {
                              "valueId": "src"
                            },
                            {
                              "valueString": "$this.item.where(linkId = 'dbf5b992-03fc-457d-93eb-d603cccc9ce5').answer.value"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "rule_mother_given_name",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "patientName",
                          "contextType": "variable",
                          "element": "given",
                          "transform": "evaluate",
                          "parameter": [
                            {
                              "valueId": "src"
                            },
                            {
                              "valueString": "$this.item.where(linkId = '46a91ed5-1ef8-4afc-8a8c-54d52258343e').answer.value"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "rule_mother_middle_name",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "patientName",
                          "contextType": "variable",
                          "element": "text",
                          "transform": "evaluate",
                          "parameter": [
                            {
                              "valueId": "src"
                            },
                            {
                              "valueString": "$this.item.where(linkId = 'dbf5b992-03fc-457d-93eb-d603cccc9ce5').answer.value"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "rule_mother_name_use",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "patientName",
                          "contextType": "variable",
                          "element": "use",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "official"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_mother_identifier",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "mother",
                      "contextType": "variable",
                      "element": "identifier",
                      "variable": "patientIdentifier",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "Identifier"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "rule_mother_identifier_value",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "patientIdentifier",
                          "contextType": "variable",
                          "element": "value",
                          "transform": "uuid"
                        }
                      ]
                    },
                    {
                      "name": "rule_mother_identifier_use",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "patientIdentifier",
                          "contextType": "variable",
                          "element": "use",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "official"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "rule_mother_identifier_period",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "patientIdentifier",
                          "contextType": "variable",
                          "element": "period",
                          "variable": "period",
                          "transform": "create",
                          "parameter": [
                            {
                              "valueString": "Period"
                            }
                          ]
                        },
                        {
                          "context": "period",
                          "contextType": "variable",
                          "element": "start",
                          "transform": "evaluate",
                          "parameter": [
                            {
                              "valueId": "src"
                            },
                            {
                              "valueString": "$this.authored"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_mother_identifier_national_id",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "mother",
                      "contextType": "variable",
                      "element": "identifier",
                      "variable": "patientIdentifierNationalId",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "Identifier"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "rule_mother_identifier_national_id_value",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "patientIdentifierNationalId",
                          "contextType": "variable",
                          "element": "value",
                          "transform": "evaluate",
                          "parameter": [
                            {
                              "valueId": "src"
                            },
                            {
                              "valueString": "$this.item.where(linkId = '6dd1b786-dc61-43e7-9cda-711f71024469').answer.value"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "rule_mother_identifier_national_id_use",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "patientIdentifierNationalId",
                          "contextType": "variable",
                          "element": "use",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "secondary"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "rule_mother_identifier_period",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "patientIdentifierNationalId",
                          "contextType": "variable",
                          "element": "period",
                          "variable": "period",
                          "transform": "create",
                          "parameter": [
                            {
                              "valueString": "Period"
                            }
                          ]
                        },
                        {
                          "context": "period",
                          "contextType": "variable",
                          "element": "start",
                          "transform": "evaluate",
                          "parameter": [
                            {
                              "valueId": "src"
                            },
                            {
                              "valueString": "$this.authored"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_mother_gender",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "mother",
                      "contextType": "variable",
                      "element": "gender",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "female"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_mother_dob",
                  "source": [
                    {
                      "context": "src",
                      "element": "item",
                      "variable": "patient_dob",
                      "condition": "(linkId = 'f331b415-9188-4add-cf3f-36019a593690')"
                    }
                  ],
                  "rule": [
                    {
                      "name": "rule__first_mother_dob",
                      "source": [
                        {
                          "context": "patient_dob",
                          "element": "answer",
                          "listMode": "first",
                          "variable": "patientBirthDateAnswer"
                        }
                      ],
                      "rule": [
                        {
                          "name": "rule_patient_dob_answer",
                          "source": [
                            {
                              "context": "patientBirthDateAnswer",
                              "element": "value",
                              "variable": "val"
                            }
                          ],
                          "target": [
                            {
                              "context": "mother",
                              "contextType": "variable",
                              "element": "birthDate",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueId": "val"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_mother_active",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "mother",
                      "contextType": "variable",
                      "element": "active",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueBoolean": true
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractPatientFather",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireResponse",
          "mode": "source"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "rule_patient",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            },
            {
              "context": "entry",
              "contextType": "variable",
              "element": "resource",
              "variable": "father",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Patient"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_patient_id_generation",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "father",
                  "contextType": "variable",
                  "element": "id",
                  "transform": "uuid"
                }
              ]
            },
            {
              "name": "rule_patient_name",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "father",
                  "contextType": "variable",
                  "element": "name",
                  "variable": "patientName",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "HumanName"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_family_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientName",
                      "contextType": "variable",
                      "element": "family",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = '945f09f7-0641-4675-8329-b02d99c5425f').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_middle_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientName",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = '945f09f7-0641-4675-8329-b02d99c5425f').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_name_use",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientName",
                      "contextType": "variable",
                      "element": "use",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "official"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier_opensrp",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "father",
                  "contextType": "variable",
                  "element": "identifier",
                  "variable": "patientIdentifierOpenSRPId",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Identifier"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_identifier_opensrp_id_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifierOpenSRPId",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "uuid"
                    }
                  ]
                },
                {
                  "name": "rule_patient_identifier_opensrp_id_use",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifierOpenSRPId",
                      "contextType": "variable",
                      "element": "use",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "official"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_identifier_period",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifierOpenSRPId",
                      "contextType": "variable",
                      "element": "period",
                      "variable": "period",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "Period"
                        }
                      ]
                    },
                    {
                      "context": "period",
                      "contextType": "variable",
                      "element": "start",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.authored"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_active",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "father",
                  "contextType": "variable",
                  "element": "active",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueBoolean": true
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_gender",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "father",
                  "contextType": "variable",
                  "element": "gender",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "male"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractRelatedPersonMother",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireReponse",
          "mode": "source"
        },
        {
          "name": "patient",
          "type": "Patient",
          "mode": "target"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "rule_entry",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            },
            {
              "context": "entry",
              "contextType": "variable",
              "element": "resource",
              "variable": "relatedPMother",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "RelatedPerson"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_related_person",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPMother",
                  "contextType": "variable",
                  "element": "id",
                  "transform": "uuid"
                }
              ]
            },
            {
              "name": "rule_related_relationship",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPMother",
                  "contextType": "variable",
                  "element": "relationship",
                  "variable": "concept",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "CodeableConcept"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_text_disp",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "Mother"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_en_cc_cod",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "coding",
                      "variable": "coding",
                      "transform": "c",
                      "parameter": [
                        {
                          "valueString": "http://snomed.info/sct"
                        },
                        {
                          "valueString": "72705000"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_en_cod_disp",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "coding",
                          "contextType": "variable",
                          "element": "display",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "Mother"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_identifier",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPMother",
                  "contextType": "variable",
                  "element": "identifier",
                  "variable": "relatedPersonIdentifier",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Identifier"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_related_person_identifier_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonIdentifier",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "uuid"
                    }
                  ]
                },
                {
                  "name": "rule_related_person_identifier_use",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonIdentifier",
                      "contextType": "variable",
                      "element": "use",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "secondary"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_name",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPMother",
                  "contextType": "variable",
                  "element": "name",
                  "variable": "relatedPersonName",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "HumanName"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_related_person_family_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonName",
                      "contextType": "variable",
                      "element": "family",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = 'dbf5b992-03fc-457d-93eb-d603cccc9ce5').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_related_person_given_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonName",
                      "contextType": "variable",
                      "element": "given",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = '46a91ed5-1ef8-4afc-8a8c-54d52258343e').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_related_person_middle_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonName",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = 'dbf5b992-03fc-457d-93eb-d603cccc9ce5').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_related_person_name_use",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonName",
                      "contextType": "variable",
                      "element": "use",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "official"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_active",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPMother",
                  "contextType": "variable",
                  "element": "active",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueBoolean": true
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_phone",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPMother",
                  "contextType": "variable",
                  "element": "telecom",
                  "variable": "phone",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "ContactPoint"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_en_cc_cod",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "phone",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = 'ae512786-8123-4711-8e72-e6f43a9d5742').answer.value"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_patient",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPMother",
                  "contextType": "variable",
                  "element": "patient",
                  "variable": "ref",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Reference"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_related_person_patient_ref",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "ref",
                      "contextType": "variable",
                      "element": "reference",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "'Patient/' + patient.id"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_related_person_patient_ref_display",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "ref",
                      "contextType": "variable",
                      "element": "display",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "relatedPerson.name.given + ' ' + relatedPerson.name.text + ' ' + relatedPerson.name.family"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractRelatedPersonFather",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireReponse",
          "mode": "source"
        },
        {
          "name": "patient",
          "type": "Patient",
          "mode": "target"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "rule_bundle_entry",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            },
            {
              "context": "entry",
              "contextType": "variable",
              "element": "resource",
              "variable": "relatedPFather",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "RelatedPerson"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_related_person",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPFather",
                  "contextType": "variable",
                  "element": "id",
                  "transform": "uuid"
                }
              ]
            },
            {
              "name": "rule_related_father_relationship",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPFather",
                  "contextType": "variable",
                  "element": "relationship",
                  "variable": "concept",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "CodeableConcept"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_text_disp",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "Father"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_en_cc_cod",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "coding",
                      "variable": "coding",
                      "transform": "c",
                      "parameter": [
                        {
                          "valueString": "http://snomed.info/sct"
                        },
                        {
                          "valueString": "72705000"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_en_cod_disp",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "coding",
                          "contextType": "variable",
                          "element": "display",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "Father"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_identifier",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPFather",
                  "contextType": "variable",
                  "element": "identifier",
                  "variable": "relatedPersonIdentifier",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Identifier"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_related_person_identifier_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonIdentifier",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "uuid"
                    }
                  ]
                },
                {
                  "name": "rule_related_person_identifier_use",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonIdentifier",
                      "contextType": "variable",
                      "element": "use",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "secondary"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_name",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPFather",
                  "contextType": "variable",
                  "element": "name",
                  "variable": "relatedPersonName",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "HumanName"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_related_person_family_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonName",
                      "contextType": "variable",
                      "element": "family",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = '945f09f7-0641-4675-8329-b02d99c5425f').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_related_person_middle_name",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonName",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = '945f09f7-0641-4675-8329-b02d99c5425f').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_related_person_name_use",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "relatedPersonName",
                      "contextType": "variable",
                      "element": "use",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "official"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_active",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPFather",
                  "contextType": "variable",
                  "element": "active",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueBoolean": true
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_patient",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPFather",
                  "contextType": "variable",
                  "element": "patient",
                  "variable": "ref",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Reference"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_related_person_patient_ref",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "ref",
                      "contextType": "variable",
                      "element": "reference",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "'Patient/' + patient.id"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_related_person_patient_ref_display",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "ref",
                      "contextType": "variable",
                      "element": "display",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "relatedPerson.name.given + ' ' + relatedPerson.name.text + ' ' + relatedPerson.name.family"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractObservationForWeight",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireResponse",
          "mode": "source"
        },
        {
          "name": "encounter",
          "type": "Encounter",
          "mode": "source"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "rule_obs",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            },
            {
              "context": "entry",
              "contextType": "variable",
              "element": "resource",
              "variable": "weightObservation",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Observation"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "r_item_child_weight_obs_id",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "weightObservation",
                  "contextType": "variable",
                  "element": "id",
                  "transform": "uuid"
                }
              ]
            },
            {
              "name": "r_obs_value_dbs_viral_load_results",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "weightObservation",
                  "contextType": "variable",
                  "element": "value",
                  "variable": "codeableConcept",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Quantity"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_obs_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "codeableConcept",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.item.where(linkId = '57e01310-0470-4832-8900-fe635111f475').answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_obs_unit",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "codeableConcept",
                      "contextType": "variable",
                      "element": "unit",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "kg"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_obs_system",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "codeableConcept",
                      "contextType": "variable",
                      "element": "system",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "http://unitsofmeasure.org"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_obs_code",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "codeableConcept",
                      "contextType": "variable",
                      "element": "code",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "weight"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_item_child_weight_obs_ref",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "weightObservation",
                  "contextType": "variable",
                  "element": "subject",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.subject"
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_item_child_weight_obs_eff",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "weightObservation",
                  "contextType": "variable",
                  "element": "effective",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "now()"
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_weight_obs_encounter",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "weightObservation",
                  "contextType": "variable",
                  "element": "encounter",
                  "variable": "encRef",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Reference"
                    }
                  ]
                },
                {
                  "context": "encRef",
                  "contextType": "variable",
                  "element": "reference",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "encounter"
                    },
                    {
                      "valueString": "'Encounter/' + $this.id"
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_weight_obs",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "bundle",
                  "contextType": "variable",
                  "element": "entry",
                  "variable": "entry"
                },
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "weightObservation"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractEncounter",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireResponse",
          "mode": "source"
        },
        {
          "name": "patient",
          "type": "Patient",
          "mode": "source"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "r_en",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            },
            {
              "context": "entry",
              "contextType": "variable",
              "element": "resource",
              "variable": "encounter",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Encounter"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "r_en_id",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "id",
                  "transform": "uuid"
                }
              ]
            },
            {
              "name": "r_en_st",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "status",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "finished"
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_cls",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "class",
                  "transform": "c",
                  "parameter": [
                    {
                      "valueString": "http://terminology.hl7.org/CodeSystem/v3-ActCode"
                    },
                    {
                      "valueString": "HH"
                    },
                    {
                      "valueString": "Home Health"
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_typ",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "type",
                  "variable": "concept",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "CodeableConcept"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_en_cc_cod",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "coding",
                      "variable": "coding",
                      "transform": "c",
                      "parameter": [
                        {
                          "valueString": "http://snomed.info/sct"
                        },
                        {
                          "valueString": "184048005"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_en_cod_disp",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "coding",
                          "contextType": "variable",
                          "element": "display",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "Registration"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_en_typ_text",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "Registration"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_prio",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "priority",
                  "variable": "concept",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "CodeableConcept"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_en_cc_cod",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "coding",
                      "variable": "coding",
                      "transform": "c",
                      "parameter": [
                        {
                          "valueString": "http://terminology.hl7.org/ValueSet/v3-ActPriority"
                        },
                        {
                          "valueString": "EL"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_en_cod_disp",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "coding",
                          "contextType": "variable",
                          "element": "display",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "elective"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_en_prio_text",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "elective"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_sub",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "subject",
                  "transform": "reference",
                  "parameter": [
                    {
                      "valueId": "patient"
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_per",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "period",
                  "variable": "enPeriod",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Period"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_en_per_start",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "enPeriod",
                      "contextType": "variable",
                      "element": "start",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "now()"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_en_per_end",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "enPeriod",
                      "contextType": "variable",
                      "element": "end",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "now()"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_reason",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "reasonCode",
                  "variable": "concept",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "CodeableConcept"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_en_rc_cod",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "coding",
                      "variable": "coding",
                      "transform": "c",
                      "parameter": [
                        {
                          "valueString": "http://smartregsiter.org/"
                        },
                        {
                          "valueString": "patient_registration"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_en_rc_cod_disp",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "coding",
                          "contextType": "variable",
                          "element": "display",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "CHW Child Registration"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_en_text",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "CHW Child Registration"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_obs",
              "source": [
                {
                  "context": "src"
                }
              ],
              "dependent": [
                {
                  "name": "ExtractObservationForWeight",
                  "variable": [
                    "src",
                    "encounter",
                    "bundle"
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}